# æ¯«ç±³æ³¢æ‰‹åŠ¿è¯†åˆ« - æ–¹æ¡ˆäºŒ:è½¨è¿¹å›¾ + ResNet + CTC

## ğŸ“š ç›®å½•

- [åŸºç¡€çŸ¥è¯†](#åŸºç¡€çŸ¥è¯†)
- [æ•´ä½“æ€è·¯](#æ•´ä½“æ€è·¯)
- [æ¨¡å‹æ¶æ„](#æ¨¡å‹æ¶æ„)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [ä½¿ç”¨æ•™ç¨‹](#ä½¿ç”¨æ•™ç¨‹)
- [å®éªŒè®¾ç½®](#å®éªŒè®¾ç½®)
- [ä»£ç ç»“æ„](#ä»£ç ç»“æ„)

---

## åŸºç¡€çŸ¥è¯†

### 1. è½¨è¿¹é‡å»º

**ä¸ºä»€ä¹ˆè¦é‡å»ºè½¨è¿¹?**
- å°†é›·è¾¾ä¿¡å·è½¬æ¢ä¸ºç›´è§‚çš„æ‰‹åŠ¿è½¨è¿¹å›¾åƒ
- æ¨¡æ‹Ÿæ‰‹å†™ç¬”è¿¹,æ›´ç¬¦åˆäººç±»è®¤çŸ¥
- ä¾¿äºä½¿ç”¨æˆç†Ÿçš„è®¡ç®—æœºè§†è§‰æ¨¡å‹å¤„ç†

**ä¸‰ç»´è½¨è¿¹æå–:**
1. **Range FFT(è·ç¦»FFT)**:æå–ç›®æ ‡è·ç¦»ä¿¡æ¯
2. **Azimuth FFT(æ–¹ä½è§’FFT)**:æå–æ°´å¹³æ–¹å‘è§’åº¦
3. **Elevation FFT(ä¿¯ä»°è§’FFT)**:æå–å‚ç›´æ–¹å‘è§’åº¦

**è½¨è¿¹å¤„ç†æµç¨‹:**
```
é›·è¾¾ä¿¡å· â†’ FFTåˆ†æ â†’ 3Dåæ ‡(è·ç¦»,æ–¹ä½,ä¿¯ä»°) 
â†’ å¡å°”æ›¼æ»¤æ³¢å¹³æ»‘ â†’ PCAé™ç»´åˆ°2D â†’ è½¨è¿¹å›¾åƒ
```

### 2. ResNetæ¶æ„

**ä¸ºä»€ä¹ˆé€‰æ‹©ResNet?**
- ResNetæ˜¯ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œ,åœ¨å›¾åƒè¯†åˆ«ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜å¼‚
- **æ®‹å·®è¿æ¥**:è§£å†³æ·±å±‚ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜
- **é¢„è®­ç»ƒæƒé‡**:ä½¿ç”¨ImageNeté¢„è®­ç»ƒæ¨¡å‹,åŠ é€Ÿæ”¶æ•›
- **å¤šå°ºåº¦ç‰¹å¾**:èåˆä¸åŒå±‚çº§çš„ç‰¹å¾,æå‡è¯†åˆ«ç²¾åº¦

**ResNetçš„ä¼˜åŠ¿:**
- æˆç†Ÿç¨³å®š,æ˜“äºè®­ç»ƒ
- æ”¯æŒå¤šç§æ·±åº¦(ResNet18/34/50)
- å¼ºå¤§çš„ç‰¹å¾æå–èƒ½åŠ›

---

## æ•´ä½“æ€è·¯

### æ•°æ®æµç¨‹å›¾

```
åŸå§‹é›·è¾¾æ•°æ® (.npy)
    â”‚
    â”‚ (å¸§æ•° Ã— 108æ ·æœ¬ç‚¹ Ã— 12é€šé“)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FFTé¢‘è°±åˆ†æ        â”‚
â”‚  - Range FFT        â”‚
â”‚  - Azimuth FFT      â”‚
â”‚  - Elevation FFT    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ (å¸§æ•° Ã— 3ç»´åæ ‡)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¨è¿¹é‡å»º           â”‚
â”‚  - å™ªå£°æ»¤é™¤         â”‚
â”‚  - ç›®æ ‡å®šä½         â”‚
â”‚  - å¡å°”æ›¼å¹³æ»‘       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ (3Dè½¨è¿¹ç‚¹åºåˆ—)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PCAé™ç»´            â”‚
â”‚  æŠ•å½±åˆ°2Då¹³é¢       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ (2Dè½¨è¿¹åæ ‡)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¨è¿¹å›¾åƒç”Ÿæˆ       â”‚
â”‚  (PNGæ ¼å¼)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ (ç°åº¦å›¾åƒ)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ResNetç¼–ç å™¨       â”‚
â”‚  - å¤šå°ºåº¦ç‰¹å¾æå–   â”‚
â”‚  - ç‰¹å¾èåˆ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ (æ—¶é—´å¸§ Ã— ç‰¹å¾ç»´åº¦)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CTCè§£ç             â”‚
â”‚  è¾“å‡ºå­—ç¬¦åºåˆ—       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
   è¯†åˆ«ç»“æœ (å•è¯)
```

### å…³é”®æ­¥éª¤è¯´æ˜

#### æ­¥éª¤1:ä¿¡å·é¢„å¤„ç†
- åŠ è½½åŸå§‹`.npy`æ–‡ä»¶
- è®¡ç®—å™ªå£°åŸºçº¿(æ‰€æœ‰å¸§çš„å¹³å‡å€¼)
- ä»æ¯å¸§ä¸­å‡å»å™ªå£°

#### æ­¥éª¤2:3Dè½¨è¿¹æå–
- **Range FFT**:ä½¿ç”¨Hannçª—å’Œé›¶å¡«å……,æå–180ä¸ªè·ç¦»bin
- **Azimuth FFT**:é€‰æ‹©ç‰¹å®šå¤©çº¿(0,1,2,3,8,9,10,11),è®¡ç®—æ–¹ä½è§’
- **Elevation FFT**:é€‰æ‹©å¤©çº¿9å’Œ7,è®¡ç®—ä¿¯ä»°è§’
- å¯¹æ¯ä¸€å¸§å®šä½ç›®æ ‡,æå–3Dåæ ‡(è·ç¦»,æ–¹ä½,ä¿¯ä»°)

#### æ­¥éª¤3:è½¨è¿¹å¹³æ»‘ä¸é™ç»´
- ä½¿ç”¨å¡å°”æ›¼æ»¤æ³¢å¹³æ»‘è½¨è¿¹,å‡å°‘å™ªå£°
- çƒåæ ‡è½¬æ¢ä¸ºç¬›å¡å°”åæ ‡(x,y,z)
- PCAé™ç»´åˆ°2Då¹³é¢,ä¿ç•™ä¸»è¦è¿åŠ¨æ–¹å‘
- è°ƒæ•´è½¨è¿¹æ–¹å‘,ç»Ÿä¸€ä¹¦å†™æ–¹å‘

#### æ­¥éª¤4:è½¨è¿¹å›¾åƒç”Ÿæˆ
- å°†2Dè½¨è¿¹ç»˜åˆ¶ä¸ºé»‘è‰²çº¿æ¡
- è‡ªé€‚åº”è°ƒæ•´å›¾åƒè¾¹ç•Œ
- ä¿å­˜ä¸ºPNGæ ¼å¼çš„ç°åº¦å›¾åƒ

#### æ­¥éª¤5:ResNetç‰¹å¾æå–
- åŠ è½½è½¨è¿¹å›¾åƒ(è°ƒæ•´å¤§å°ä¸º128Ã—256)
- ResNetæå–å¤šå°ºåº¦ç‰¹å¾(layer3 + layer4)
- ç‰¹å¾èåˆ,ä¿ç•™ç©ºé—´ä¿¡æ¯(2è¡Œç‰¹å¾)
- è¾“å‡ºåºåˆ—ç‰¹å¾ä¾›CTCä½¿ç”¨

#### æ­¥éª¤6:CTCåºåˆ—è¯†åˆ«
- CTCå±‚è¾“å‡ºæ¯ä¸ªæ—¶é—´æ­¥çš„å­—ç¬¦æ¦‚ç‡
- ä½¿ç”¨è´ªå¿ƒè§£ç å¾—åˆ°æœ€ç»ˆå•è¯
- (å¯é€‰)ä½¿ç”¨è¯­è¨€æ¨¡å‹è¿›è¡Œæ‹¼å†™çº æ­£

---

## æ¨¡å‹æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
è¾“å…¥: (batch, 1, 128, 256) ç°åº¦å›¾
           â”‚
           â†“
    ResNet Backbone
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Conv1+BN+ReLUâ”‚
    â”‚  MaxPool      â”‚
    â”‚  Layer1       â”‚
    â”‚  Layer2       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â†“           â†“
  Layer3      Layer4
  (ä¸­å±‚ç‰¹å¾) (é«˜å±‚ç‰¹å¾)
     â”‚           â”‚
     â†“           â†“
  Projection  Projection
  [D/2]        [D/2]
     â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â†“
      ç‰¹å¾èåˆ
    (Concatenate)
      [Dé€šé“]
           â”‚
           â†“
     èåˆå·ç§¯
    (Conv+BN+ReLU)
           â”‚
           â†“
   è‡ªé€‚åº”æ± åŒ–(2è¡Œ)
    [B, D, 2, W/8]
           â”‚
           â†“
     åºåˆ—å±•å¹³
   [B, W/8, D*2]
           â”‚
           â†“
      çº¿æ€§æŠ•å½±
    [B, W/8, D]
           â”‚
           â†“
      CTCåˆ†ç±»å¤´
   (Dropout+Linear)
           â”‚
           â†“
   [B, W/8, vocab_size]
```

### è¯¦ç»†å‚æ•°é…ç½®

| æ¨¡å— | å‚æ•° | è¯´æ˜ |
|------|------|------|
| **è¾“å…¥å›¾åƒ** | 128Ã—256 | ç°åº¦å›¾,æ ‡å‡†åŒ–åˆ°[-1,1] |
| **ResNetç±»å‹** | ResNet50(é»˜è®¤) | æ”¯æŒResNet18/34/50 |
| **ç‰¹å¾ç»´åº¦** | 512 | ç¼–ç å™¨è¾“å‡ºç»´åº¦ |
| **å¤šå°ºåº¦èåˆ** | Layer3+Layer4 | ä¸­å±‚+é«˜å±‚ç‰¹å¾ |
| **ç©ºé—´æ± åŒ–** | (2, None) | ä¿ç•™2è¡Œé«˜åº¦ä¿¡æ¯ |
| **åºåˆ—é•¿åº¦** | W/8 | çº¦32æ—¶é—´æ­¥ |
| **Dropout** | 0.1 | é˜²æ­¢è¿‡æ‹Ÿåˆ |
| **è¯æ±‡è¡¨** | 28ä¸ª | blank + unk + 26ä¸ªå­—æ¯ |

### ResNet Blockè¯¦è§£

æ¯ä¸ªResNet LayeråŒ…å«å¤šä¸ªBottleneck/BasicBlock:

```
ResNet50 Bottleneck:
1. 1Ã—1å·ç§¯é™ç»´ (channels â†’ channels/4)
2. 3Ã—3å·ç§¯æå–ç‰¹å¾
3. 1Ã—1å·ç§¯å‡ç»´ (channels/4 â†’ channels)
4. æ®‹å·®è¿æ¥ + ReLU

ç‰¹å¾ä¸‹é‡‡æ ·å€æ•°:
- Layer1: 4å€ (stride=1)
- Layer2: 8å€ (stride=2)
- Layer3: 16å€ (stride=2)
- Layer4: 32å€ (stride=2)
```

### å¢å¼ºç‰¹æ€§

**å¤šå°ºåº¦ç‰¹å¾èåˆ:**
- Layer3æä¾›æ›´ç»†ç²’åº¦çš„å±€éƒ¨ç‰¹å¾
- Layer4æä¾›æ›´æŠ½è±¡çš„å…¨å±€ç‰¹å¾
- ä¸Šé‡‡æ ·+æ‹¼æ¥èåˆä¸¤è·¯ç‰¹å¾

**ç©ºé—´ä¿¡æ¯ä¿ç•™:**
- ä¿ç•™2è¡Œé«˜åº¦ä¿¡æ¯è€Œé1è¡Œ
- å¢å¼ºå¯¹å­—æ¯ç»†èŠ‚çš„æ•æ‰èƒ½åŠ›
- ç‰¹åˆ«é€‚åˆåŒºåˆ†å½¢çŠ¶ç›¸ä¼¼çš„å­—æ¯(å¦‚i/l, m/n)

---

## ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux / macOS(ä¸å»ºè®®) / Windows
- **Pythonç‰ˆæœ¬**: 3.8+
- **GPU**: NVIDIA GPU (æ¨è,æ”¯æŒCUDA 11.0+)
- **å†…å­˜**: è‡³å°‘16GB RAM
- **ç¡¬ç›˜**: è‡³å°‘10GBå¯ç”¨ç©ºé—´

### ä¾èµ–åº“å®‰è£…

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ(æ¨è)
conda create -n mmPencil-trajectory python=3.8
conda activate mmPencil-trajectory

# å®‰è£…PyTorch(æ ¹æ®ä½ çš„CUDAç‰ˆæœ¬é€‰æ‹©)
# CUDA 11.8ç‰ˆæœ¬
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# æˆ–è€…CPUç‰ˆæœ¬(ä¸å»ºè®®)
pip install torch torchvision torchaudio

# å®‰è£…å…¶ä»–ä¾èµ–
pip install numpy
pip install tqdm
pip install pykalman
pip install scikit-learn
pip install editdistance
pip install Pillow
pip install matplotlib

# (å¯é€‰)å¦‚æœéœ€è¦LLMæ‹¼å†™çº æ­£
pip install vllm
```

---

## ä½¿ç”¨æ•™ç¨‹

**ä¸‹è½½mmpencilæ•°æ®é›†**

æ”¾ç½®åœ¨mmPencil_dataset/mmWave/ç›®å½•ä¸‹

### ç¬¬ä¸€æ­¥:æ•°æ®é¢„å¤„ç†(ä¿¡å·â†’è½¨è¿¹å›¾)

**è„šæœ¬è¯´æ˜ï¼š** ç¬¬ä¸€ä¸ªä»£ç æ–‡ä»¶è´Ÿè´£å°†åŸå§‹æ¯«ç±³æ³¢ä¿¡å·è½¬æ¢ä¸º2Dè½¨è¿¹å›¾åƒã€‚

**è¾“å…¥æ•°æ®æ ¼å¼ï¼š**
```
mmPencil_dataset/mmWave/
â”œâ”€â”€ User-01/
â”œâ”€â”€ User-02/
â”‚   â”œâ”€â”€ 200-Word/
â”‚   â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â”‚   â”œâ”€â”€ w01.npy
â”‚   â”‚   â”‚   â”œâ”€â”€ w02.npy
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

```bash
# è¿è¡Œè½¨è¿¹é‡å»º
cd NWPU_AIoT_Laboratory/
python trajectory-based_recognition/01_signal_to_trajectory.py
```

**è¾“å‡ºæ•°æ®æ ¼å¼:**
```
mmPencil_dataset/mmWave_Trajectory/
â”œâ”€â”€ 200-Word_User-01_word1_w01.png  # è½¨è¿¹å›¾åƒ
â”œâ”€â”€ 200-Word_User-01_word1_w02.png
â””â”€â”€ ...
```

**å¤„ç†æµç¨‹è¯´æ˜:**
1. åŠ è½½`.npy`é›·è¾¾æ•°æ®
2. æ‰§è¡ŒRange/Azimuth/Elevation FFT
3. æå–æ¯ä¸€å¸§çš„ç›®æ ‡3Dåæ ‡
4. å¡å°”æ›¼æ»¤æ³¢å¹³æ»‘è½¨è¿¹
5. PCAé™ç»´åˆ°2D
6. ç»˜åˆ¶å¹¶ä¿å­˜è½¨è¿¹å›¾åƒ

**å¹¶è¡Œå¤„ç†:**
- ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†,åŠ é€Ÿè½¬æ¢
- è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶
- æ˜¾ç¤ºè¿›åº¦æ¡

---

### ç¬¬äºŒæ­¥:æ•°æ®é›†åˆ’åˆ†

**è„šæœ¬è¯´æ˜:** ç¬¬äºŒä¸ªä»£ç æ–‡ä»¶å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†,æ”¯æŒä¸‰ç§å®éªŒè®¾ç½®ã€‚

```bash
# è¿è¡Œæ•°æ®é›†åˆ’åˆ†
python trajectory-based_recognition/02_dataset_split.py
```

**ä¸‰ç§å®éªŒè®¾ç½®:**

#### 1. æ ‡å‡†200è¯è¯†åˆ« (`200-Word.json`)
- **è®­ç»ƒé›†**: æ¯ä¸ªå•è¯éšæœºé€‰20ä¸ªæ ·æœ¬ (200Ã—20 = 4000æ ·æœ¬)
- **æµ‹è¯•é›†**: æ¯ä¸ªå•è¯å‰©ä½™4ä¸ªæ ·æœ¬ (200Ã—4 = 800æ ·æœ¬)
- **ç›®çš„**: è¯„ä¼°æ¨¡å‹åœ¨è§è¿‡çš„å•è¯ä¸Šçš„è¯†åˆ«èƒ½åŠ›

#### 2. é›¶æ ·æœ¬å­¦ä¹  (`zero-shot.json`)
- **è®­ç»ƒé›†**: 150ä¸ªå•è¯çš„æ‰€æœ‰æ ·æœ¬ (150Ã—24 = 3600æ ·æœ¬)
- **æµ‹è¯•é›†**: 50ä¸ªå•è¯çš„æ‰€æœ‰æ ·æœ¬ (50Ã—24 = 1200æ ·æœ¬)
- **ç›®çš„**: è¯„ä¼°æ¨¡å‹æ³›åŒ–åˆ°æ–°å•è¯çš„èƒ½åŠ›

#### 3. è·¨ç”¨æˆ·è¯†åˆ« (`user-split.json`)
- **è®­ç»ƒé›†**: User-01å’ŒUser-02çš„æ‰€æœ‰æ•°æ®
- **æµ‹è¯•é›†**: User-03å’ŒUser-04çš„æ‰€æœ‰æ•°æ®
- **ç›®çš„**: è¯„ä¼°æ¨¡å‹è·¨ç”¨æˆ·çš„æ³›åŒ–èƒ½åŠ›

---

### ç¬¬ä¸‰æ­¥:æ¨¡å‹è®­ç»ƒ

**è„šæœ¬è¯´æ˜:** ç¬¬ä¸‰ä¸ªä»£ç æ–‡ä»¶å®ç°å®Œæ•´çš„è®­ç»ƒã€æµ‹è¯•å’Œæ¨ç†æµç¨‹ã€‚

#### åŸºæœ¬è®­ç»ƒå‘½ä»¤

```bash
# è®­ç»ƒ200è¯è¯†åˆ«æ¨¡å‹(ResNet50)
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment 200word

# è®­ç»ƒé›¶æ ·æœ¬å­¦ä¹ æ¨¡å‹
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment zero_shot

# è®­ç»ƒè·¨ç”¨æˆ·è¯†åˆ«æ¨¡å‹
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment cross_user

# ä½¿ç”¨ResNet18(æ›´å¿«,å‚æ•°æ›´å°‘)
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment 200word --encoder resnet18

# ä½¿ç”¨ResNet34(å¹³è¡¡æ€§èƒ½)
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment 200word --encoder resnet34
```

#### è®­ç»ƒå‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--experiment` | **å¿…éœ€** | å®éªŒç±»å‹: 200word / zero_shot / cross_user |
| `--encoder` | resnet50 | ResNetç±»å‹: resnet18 / resnet34 / resnet50 |
| `--batch_size` | 16 | æ‰¹æ¬¡å¤§å° |
| `--learning_rate` | 1e-4 | åˆå§‹å­¦ä¹ ç‡ |
| `--num_epochs` | 20 | è®­ç»ƒè½®æ•° |
| `--gpus` | è‡ªåŠ¨æ£€æµ‹ | ä½¿ç”¨çš„GPUæ•°é‡ |
| `--config` | None | é¢å¤–é…ç½®æ–‡ä»¶è·¯å¾„ |

#### é«˜çº§é…ç½®ç¤ºä¾‹

åˆ›å»ºé…ç½®æ–‡ä»¶ `config.json`:
```json
{
  "batch_size": 32,
  "learning_rate": 5e-5,
  "num_epochs": 30,
  "feature_dim": 512,
  "freeze_backbone": false,
  "dropout": 0.2,
  "warmup_epochs": 5,
  "weight_decay": 1e-5
}
```

ä½¿ç”¨é…ç½®æ–‡ä»¶è®­ç»ƒ:
```bash
python trajectory-based_recognition/03_resnet_ctc_train.py \
  --experiment 200word \
  --config config.json
```

#### è®­ç»ƒç»“æœ

è®­ç»ƒå®Œæˆå,ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶:

1. **æ¨¡å‹æ–‡ä»¶** (`.pth`)
```
trajectory-based_recognition/output/
â””â”€â”€ mmwave_resnet50_ctc_model.pth  # ä¿å­˜æœ€ä½³æ¨¡å‹
```

æ¨¡å‹æ–‡ä»¶åŒ…å«:
- `model_state_dict`: æ¨¡å‹æƒé‡
- `optimizer_state_dict`: ä¼˜åŒ–å™¨çŠ¶æ€
- `char_to_idx`: å­—ç¬¦åˆ°ç´¢å¼•çš„æ˜ å°„
- `config`: è®­ç»ƒé…ç½®
- `best_test_acc`: æœ€ä½³æµ‹è¯•å‡†ç¡®ç‡
- `epoch`: è®­ç»ƒè½®æ•°

2. **æ¨ç†ç»“æœ** (`.jsonl`)
```
trajectory-based_recognition/output/
â”œâ”€â”€ inference_results_resnet50_ctc.jsonl  # è¯¦ç»†æ¨ç†ç»“æœ
â””â”€â”€ stats_original_inference_results_resnet50_ctc.json  # ç»Ÿè®¡ä¿¡æ¯
```

3. **LLMè¾“å…¥æ–‡ä»¶** (`.jsonl`)
```
trajectory-based_recognition/output/
â””â”€â”€ llm_input_inference_results_resnet50_ctc.jsonl  # ç”¨äºæ‹¼å†™çº æ­£
```

---

### ç¬¬å››æ­¥:æ¨¡å‹è¯„ä¼°

è®­ç»ƒå®Œæˆå,æ¨¡å‹ä¼šè‡ªåŠ¨åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯¦ç»†è¯„ä¼°,å¹¶ç”Ÿæˆä»¥ä¸‹æŒ‡æ ‡:

#### è¯„ä¼°æŒ‡æ ‡è¯´æ˜

1. **å•è¯å‡†ç¡®ç‡ (Word Accuracy)**
   - å®šä¹‰:å®Œå…¨æ­£ç¡®è¯†åˆ«çš„å•è¯æ•° / æ€»å•è¯æ•°
   - å…¬å¼:`Acc_word = N_correct / N_total`
   - ç¤ºä¾‹:é¢„æµ‹"hello",çœŸå®"hello" â†’ æ­£ç¡® âœ“

2. **å­—æ¯å‡†ç¡®ç‡ (Character Accuracy)**
   - å®šä¹‰:åŸºäºç¼–è¾‘è·ç¦»çš„å­—ç¬¦çº§å‡†ç¡®ç‡
   - å…¬å¼:`Acc_char = 1 - (æ€»ç¼–è¾‘è·ç¦» / æ€»å­—ç¬¦æ•°)`
   - ç¤ºä¾‹:é¢„æµ‹"helo",çœŸå®"hello" â†’ ç¼–è¾‘è·ç¦»=1,å­—æ¯å‡†ç¡®ç‡=4/5=0.8

3. **å¹³å‡ç¼–è¾‘è·ç¦» (Average Edit Distance)**
   - å®šä¹‰:é¢„æµ‹å•è¯ä¸çœŸå®å•è¯ä¹‹é—´çš„å¹³å‡ç¼–è¾‘æ“ä½œæ¬¡æ•°
   - åŒ…æ‹¬:æ’å…¥ã€åˆ é™¤ã€æ›¿æ¢æ“ä½œ
   - ç¤ºä¾‹:
     - "hello" â†’ "helo": è·ç¦»=1 (åˆ é™¤1ä¸ªl)
     - "world" â†’ "word": è·ç¦»=1 (åˆ é™¤1ä¸ªl)

---

### ç¬¬äº”æ­¥:(å¯é€‰)LLMæ‹¼å†™çº æ­£

**è„šæœ¬è¯´æ˜:** ç¬¬å››ä¸ªä»£ç æ–‡ä»¶ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹å¯¹è¯†åˆ«ç»“æœè¿›è¡Œæ‹¼å†™çº æ­£ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦æ‹¼å†™çº æ­£?

- CTCæ¨¡å‹å¯èƒ½äº§ç”Ÿæ‹¼å†™é”™è¯¯(å¦‚"helo" â†’ "hello")
- è¯­è¨€æ¨¡å‹å¯ä»¥åˆ©ç”¨è‹±è¯­å•è¯çŸ¥è¯†è¿›è¡Œçº æ­£
- è¿›ä¸€æ­¥æå‡è¯†åˆ«å‡†ç¡®ç‡

#### ä½¿ç”¨vLLMè¿›è¡Œæ‰¹é‡çº æ­£

```bash
# åŸºæœ¬ä½¿ç”¨
python trajectory-based_recognition/04_llm_correction.py \
  --input trajectory-based_recognition/output/llm_input_inference_results_resnet50_ctc.jsonl \
  --output trajectory-based_recognition/output/llm_output_inference_results_resnet50_ctc.jsonl \
  --model /path/to/your/llm/model

# æŒ‡å®šæ‰¹æ¬¡å¤§å°å’Œå‚æ•°
python trajectory-based_recognition/04_llm_correction.py \
  --input trajectory-based_recognition/output/llm_input_inference_results_resnet50_ctc.jsonl \
  --output trajectory-based_recognition/output/llm_output_inference_results_resnet50_ctc.jsonl \
  --model /path/to/your/llm/model \
  --batch-size 256 \
  --max-tokens 10 \
  --temperature 0.0
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--input` | **å¿…éœ€** | LLMè¾“å…¥æ–‡ä»¶è·¯å¾„ |
| `--output` | **å¿…éœ€** | LLMè¾“å‡ºæ–‡ä»¶è·¯å¾„ |
| `--model` | models/Qwen3-0.6B | è¯­è¨€æ¨¡å‹è·¯å¾„ |
| `--batch-size` | 256 | æ‰¹æ¬¡å¤§å° |
| `--max-tokens` | 10 | æœ€å¤§ç”Ÿæˆtokenæ•° |
| `--temperature` | 0.0 | é‡‡æ ·æ¸©åº¦(0.0è¡¨ç¤ºè´ªå¿ƒ) |

#### çº æ­£ç»“æœç¤ºä¾‹

```
================================================================================
çº æ­£ç»“æœç»Ÿè®¡
================================================================================
æ€»æ ·æœ¬æ•°: 800
åŸå§‹æ­£ç¡®æ•°: 720 (0.9000, 90.00%)
çº æ­£åæ­£ç¡®æ•°: 760 (0.9500, 95.00%)
å‡†ç¡®ç‡æå‡: +0.0500 (+5.00%)
æ”¹è¿›æ ·æœ¬æ•°: 45
é€€åŒ–æ ·æœ¬æ•°: 5
å‡€æå‡: 40
================================================================================

çº æ­£ç¤ºä¾‹(å‰20ä¸ª):
çœŸå®         åŸå§‹é¢„æµ‹      LMçº æ­£       åŸå§‹   çº æ­£  
------------------------------------------------------------
hello        helo         hello        âœ—      âœ“     
world        wrold        world        âœ—      âœ“     
apple        aple         apple        âœ—      âœ“     
...
```

#### è¾“å‡ºæ–‡ä»¶

1. **çº æ­£ç»“æœ** (`llm_output_*.jsonl`)
```json
{
  "custom_id": "request-0",
  "original_prediction": "helo",
  "ground_truth": "hello",
  "lm_output": "hello",
  "corrected_word": "hello",
  "original_correct": false,
  "corrected_correct": true
}
```

2. **ç»Ÿè®¡ä¿¡æ¯** (`stats_corrected_*.json`)
```json
{
  "total_samples": 800,
  "original_correct": 720,
  "corrected_correct": 760,
  "original_accuracy": 0.9000,
  "corrected_accuracy": 0.9500,
  "accuracy_improvement": 0.0500,
  "improved_samples": 45,
  "degraded_samples": 5,
  "net_improvement": 40
}
```

3. **åŸå§‹LLMè¾“å‡º** (`raw_llm_output_*.jsonl`) - ç”¨äºè°ƒè¯•

---

## å®éªŒè®¾ç½®ï¼ˆåŒæ–¹æ¡ˆä¸€ï¼‰

### ä¸‰ç§å®éªŒçš„è¯¦ç»†è¯´æ˜

#### å®éªŒ1:æ ‡å‡†200è¯è¯†åˆ«

**ç›®æ ‡**: è¯„ä¼°æ¨¡å‹åœ¨å·²çŸ¥è¯æ±‡ä¸Šçš„è¯†åˆ«èƒ½åŠ›

**æ•°æ®åˆ’åˆ†**:
- 200ä¸ªå•è¯,æ¯ä¸ªå•è¯24ä¸ªæ ·æœ¬
- è®­ç»ƒé›†:æ¯ä¸ªå•è¯20ä¸ªæ ·æœ¬(å…±4000æ ·æœ¬)
- æµ‹è¯•é›†:æ¯ä¸ªå•è¯4ä¸ªæ ·æœ¬(å…±800æ ·æœ¬)

**è®­ç»ƒå‘½ä»¤**:
```bash
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment 200word
```

---

#### å®éªŒ2:é›¶æ ·æœ¬å­¦ä¹ 

**ç›®æ ‡**: è¯„ä¼°æ¨¡å‹æ³›åŒ–åˆ°æ–°å•è¯çš„èƒ½åŠ›

**æ•°æ®åˆ’åˆ†**:
- è®­ç»ƒé›†:150ä¸ªå•è¯çš„æ‰€æœ‰æ ·æœ¬(3600æ ·æœ¬)
- æµ‹è¯•é›†:50ä¸ªæ–°å•è¯çš„æ‰€æœ‰æ ·æœ¬(1200æ ·æœ¬)
- **å…³é”®**: æµ‹è¯•é›†çš„å•è¯åœ¨è®­ç»ƒæ—¶ä»æœªè§è¿‡

**æŒ‘æˆ˜**:
- æ¨¡å‹éœ€è¦å­¦ä¹ å­—æ¯çº§åˆ«çš„ç‰¹å¾,è€Œä¸æ˜¯è®°å¿†å•è¯
- è€ƒéªŒæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›
- è½¨è¿¹å›¾çš„è§†è§‰ç›¸ä¼¼æ€§å¯èƒ½å¸¦æ¥é¢å¤–æŒ‘æˆ˜

**é€‚ç”¨åœºæ™¯**:
- å¼€æ”¾è¯æ±‡è¡¨çš„æ‰‹åŠ¿è¯†åˆ«
- éœ€è¦è¯†åˆ«ä»»æ„è‹±æ–‡å•è¯çš„åº”ç”¨

**è®­ç»ƒå‘½ä»¤**:
```bash
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment zero_shot
```

---

#### å®éªŒ3:è·¨ç”¨æˆ·è¯†åˆ«

**ç›®æ ‡**: è¯„ä¼°æ¨¡å‹è·¨ç”¨æˆ·çš„æ³›åŒ–èƒ½åŠ›

**æ•°æ®åˆ’åˆ†**:
- è®­ç»ƒé›†:User-01å’ŒUser-02çš„æ‰€æœ‰æ•°æ®
- æµ‹è¯•é›†:User-03å’ŒUser-04çš„æ‰€æœ‰æ•°æ®
- **å…³é”®**: ä¸åŒç”¨æˆ·çš„ä¹¦å†™ä¹ æƒ¯ã€æ‰‹åŠ¿é€Ÿåº¦å¯èƒ½ä¸åŒ

**æŒ‘æˆ˜**:
- ç”¨æˆ·é—´çš„æ‰‹åŠ¿å·®å¼‚
- ä¹¦å†™é£æ ¼çš„ä¸ªæ€§åŒ–
- è½¨è¿¹ç²—ç»†ã€é€Ÿåº¦çš„å˜åŒ–

**é€‚ç”¨åœºæ™¯**:
- å¤šç”¨æˆ·å…±äº«çš„æ‰‹åŠ¿è¯†åˆ«ç³»ç»Ÿ
- æ— éœ€ç”¨æˆ·æ³¨å†Œçš„åº”ç”¨

**è®­ç»ƒå‘½ä»¤**:
```bash
python trajectory-based_recognition/03_resnet_ctc_train.py --experiment cross_user
```

---

## ä»£ç ç»“æ„

### æ–‡ä»¶ç»„ç»‡

```
NWPU_AIoT_Laboratory/
â”œâ”€â”€ mmPencil_dataset/
â”‚   â”œâ”€â”€ mmWave/                     # åŸå§‹é›·è¾¾æ•°æ®
â”‚   â”‚   â””â”€â”€ 200-Word/
â”‚   â”‚       â””â”€â”€ User-XX/
â”‚   â”‚           â””â”€â”€ word/
â”‚   â”‚               â”œâ”€â”€ wXX.npy    # (å¸§æ•°, 108, 12)
â”‚   â”‚               â””â”€â”€ ......
â”‚   â””â”€â”€ mmWave_Trajectory/          # è½¨è¿¹å›¾åƒ
â”‚       â”œâ”€â”€ 200-Word_User-XX_word_wXX.png  # 128Ã—256 ç°åº¦å›¾
â”‚       â””â”€â”€ ......
â”‚
â”œâ”€â”€ trajectory-based_recognition/
â”‚   â”œâ”€â”€ dataset_index/              # æ•°æ®é›†åˆ’åˆ†JSONæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ 200-Word.json
â”‚   â”‚   â”œâ”€â”€ zero-shot.json
â”‚   â”‚   â””â”€â”€ user-split.json
â”‚   â””â”€â”€ output/                     # è®­ç»ƒè¾“å‡º
â”‚       â”œâ”€â”€ mmwave_resnet50_ctc_model.pth
â”‚       â”œâ”€â”€ inference_results_resnet50_ctc.jsonl
â”‚       â”œâ”€â”€ llm_input_*.jsonl
â”‚       â”œâ”€â”€ llm_output_*.jsonl
â”‚       â”œâ”€â”€ stats_*.json
â”‚       â””â”€â”€ ......
â”‚
â”œâ”€â”€ 01_signal_to_trajectory.py      # ä¿¡å·â†’è½¨è¿¹å›¾
â”œâ”€â”€ 02_dataset_split.py             # æ•°æ®é›†åˆ’åˆ†
â”œâ”€â”€ 03_resnet_ctc_train.py          # è®­ç»ƒä¸»ç¨‹åº
â”œâ”€â”€ 04_llm_correction.py            # LLMæ‹¼å†™çº æ­£
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£
```
---

**ç¥å­¦ä¸šé¡ºåˆ©!ğŸ‰ğŸ‰ğŸ‰**

---